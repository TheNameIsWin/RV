name: "Basic Slack Deployment Info"
run-name: "Manual Deployment Trigger"

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PR number"
        required: true
        type: string

permissions:
  contents: read
  pull-requests: read

jobs:
  send-slack:
    runs-on: ubuntu-latest

    steps:
      - name: Get PR Title
      run: |
        PR="${{ inputs.pr_number }}"
        echo "Fetching PR #$PR"

        API_URL="https://api.github.com/repos/${{ github.repository }}/pulls/$PR"

        RESPONSE=$(curl -s -H "Authorization: token ${{ github.token }}" "$API_URL")

        TITLE=$(echo "$RESPONSE" | jq -r '.title')

        if [[ "$TITLE" == "null" ]]; then
          TITLE="(Could not fetch PR title)"
        fi

        echo "PR_TITLE=$TITLE" >> $GITHUB_ENV

      - name: Send Slack Notification
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
        run: |
          echo "Sending slack message..."
          curl -X POST -H 'Content-type: application/json' \
            --data "{
              \"text\": \"ðŸš€ Deployment Triggered\n*PR:* #${{ inputs.pr_number }}\n*Title:* $PR_TITLE\"
            }" \
            $SLACK_WEBHOOK
